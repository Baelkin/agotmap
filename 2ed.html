<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title> - jsFiddle demo</title>
  
  <script type='text/javascript' src='http://code.jquery.com/jquery-1.8.3.js'></script>
  
  
  
  <link rel="stylesheet" type="text/css" href="/css/result-light.css">
  
  <link rel="stylesheet" type="text/css" href="main.css">
  

<!-- <script type="text/javascript" src="somefile.js"></script> -->
<script type='text/javascript'>//<![CDATA[ 
$(window).load(function(){


var LZString = {

  writeBit : function(value, data) {
    data.val = (data.val << 1) | value;
    if (data.position == 15) {
      data.position = 0;
      data.string += String.fromCharCode(data.val);
      data.val = 0;
    } else {
      data.position++;
    }
  },
  
  writeBits : function(numBits, value, data) {
    if (typeof(value)=="string")
      value = value.charCodeAt(0);
    for (var i=0 ; i<numBits ; i++) {
      this.writeBit(value&1, data);
      value = value >> 1;
    }
  },
  
  produceW : function (context) {
    if (context.dictionaryToCreate.hasOwnProperty(context.w)) {
      if (context.w.charCodeAt(0)<256) {
        this.writeBits(context.numBits, 0, context.data);
        this.writeBits(8, context.w, context.data);
      } else {
        this.writeBits(context.numBits, 1, context.data);
        this.writeBits(16, context.w, context.data);
      }
      this.decrementEnlargeIn(context);
      delete context.dictionaryToCreate[context.w];
    } else {
      this.writeBits(context.numBits, context.dictionary[context.w], context.data);
    }
    this.decrementEnlargeIn(context);
  },
  
  decrementEnlargeIn : function(context) {
    context.enlargeIn--;
    if (context.enlargeIn == 0) {
      context.enlargeIn = Math.pow(2, context.numBits);
      context.numBits++;
    }
  },
  
  compress: function (uncompressed) {
    var context = {
      dictionary: {},
      dictionaryToCreate: {},
      c:"",
      wc:"",
      w:"",
      enlargeIn: 2, 
      dictSize: 3,
      numBits: 2,
      result: "",
      data: {string:"", val:0, position:0}
    }, i;
    
    for (i = 0; i < uncompressed.length; i += 1) {
      context.c = uncompressed.charAt(i);
      if (!context.dictionary.hasOwnProperty(context.c)) {
        context.dictionary[context.c] = context.dictSize++;
        context.dictionaryToCreate[context.c] = true;
      }
      
      context.wc = context.w + context.c;
      if (context.dictionary.hasOwnProperty(context.wc)) {
        context.w = context.wc;
      } else {
        this.produceW(context);
        context.dictionary[context.wc] = context.dictSize++;
        context.w = String(context.c);
      }
    }
    
    if (context.w !== "") {
      this.produceW(context);
    }
    
    this.writeBits(context.numBits, 2, context.data);
    
    while (context.data.val>0) this.writeBit(0,context.data)
    return context.data.string;
  },
  
  readBit : function(data) {
    var res = data.val & data.position;
    data.position >>= 1;
    if (data.position == 0) {
      data.position = 32768;
      data.val = data.string.charCodeAt(data.index++);
    }
    return res>0 ? 1 : 0;
  },
  
  readBits : function(numBits, data) {
    var res = 0;
    var maxpower = Math.pow(2,numBits);
    var power=1;
    while (power!=maxpower) {
      res |= this.readBit(data) * power;
      power <<= 1;
    }
    return res;
  },
  
  decompress: function (compressed) {
    var dictionary = {},
        next,
        enlargeIn = 4,
        dictSize = 4,
        numBits = 3,
        entry = "",
        result = "",
        w,
        c,
        errorCount=0,
        literal,
        data = {string:compressed, val:compressed.charCodeAt(0), position:32768, index:1};
    
    for (i = 0; i < 3; i += 1) {
      dictionary[i] = i;
    }
    
    next = this.readBits(2, data);
    switch (next) {
      case 0: 
        c = String.fromCharCode(this.readBits(8, data));
        break;
      case 1: 
        c = String.fromCharCode(this.readBits(16, data));
        break;
      case 2: 
        return "";
    }
    dictionary[3] = c;
    w = result = c;
    while (true) {
      c = this.readBits(numBits, data);
      
      switch (c) {
        case 0: 
          if (errorCount++ > 10000) return "Error";
          c = String.fromCharCode(this.readBits(8, data));
          dictionary[dictSize++] = c;
          c = dictSize-1;
          enlargeIn--;
          break;
        case 1: 
          c = String.fromCharCode(this.readBits(16, data));
          dictionary[dictSize++] = c;
          c = dictSize-1;
          enlargeIn--;
          break;
        case 2: 
          return result;
      }
      
      if (enlargeIn == 0) {
        enlargeIn = Math.pow(2, numBits);
        numBits++;
      }

      if (dictionary[c]) {
        entry = dictionary[c];
      } else {
        if (c === dictSize) {
          entry = w + w.charAt(0);
        } else {
          return null;
        }
      }
      result += entry;
      
      dictionary[dictSize++] = w + entry.charAt(0);
      enlargeIn--;
      
      w = entry;
      
      if (enlargeIn == 0) {
        enlargeIn = Math.pow(2, numBits);
        numBits++;
      }
      
    }
    return result;
  }
};

var Base64 = {
 
	// private property
	_keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
 
	// public method for encoding
	encode : function (input) {
		var output = "";
		var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
		var i = 0;
 
		input = Base64._utf8_encode(input);
 
		while (i < input.length) {
 
			chr1 = input.charCodeAt(i++);
			chr2 = input.charCodeAt(i++);
			chr3 = input.charCodeAt(i++);
 
			enc1 = chr1 >> 2;
			enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
			enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
			enc4 = chr3 & 63;
 
			if (isNaN(chr2)) {
				enc3 = enc4 = 64;
			} else if (isNaN(chr3)) {
				enc4 = 64;
			}
 
			output = output +
			this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +
			this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);
 
		}
 
		return output;
	},

	urlSafeEncode : function(input) {
		return Base64.encode(input).replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, ".");
	},
 
	// public method for decoding
	decode : function (input) {
		var output = "";
		var chr1, chr2, chr3;
		var enc1, enc2, enc3, enc4;
		var i = 0;
 
		input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
 
		while (i < input.length) {
 
			enc1 = this._keyStr.indexOf(input.charAt(i++));
			enc2 = this._keyStr.indexOf(input.charAt(i++));
			enc3 = this._keyStr.indexOf(input.charAt(i++));
			enc4 = this._keyStr.indexOf(input.charAt(i++));
 
			chr1 = (enc1 << 2) | (enc2 >> 4);
			chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
			chr3 = ((enc3 & 3) << 6) | enc4;
 
			output = output + String.fromCharCode(chr1);
 
			if (enc3 != 64) {
				output = output + String.fromCharCode(chr2);
			}
			if (enc4 != 64) {
				output = output + String.fromCharCode(chr3);
			}
 
		}
 
		output = Base64._utf8_decode(output);
 
		return output;
 
	},

	urlSafeDecode : function(input) {
		return Base64.decode(input.replace(/-/g, "+").replace(/_/g, "/").replace(/\./g, "="));
	},
 
	// private method for UTF-8 encoding
	_utf8_encode : function (string) {
		string = string.replace(/\r\n/g,"\n");
		var utftext = "";
 
		for (var n = 0; n < string.length; n++) {
 
			var c = string.charCodeAt(n);
 
			if (c < 128) {
				utftext += String.fromCharCode(c);
			}
			else if((c > 127) && (c < 2048)) {
				utftext += String.fromCharCode((c >> 6) | 192);
				utftext += String.fromCharCode((c & 63) | 128);
			}
			else {
				utftext += String.fromCharCode((c >> 12) | 224);
				utftext += String.fromCharCode(((c >> 6) & 63) | 128);
				utftext += String.fromCharCode((c & 63) | 128);
			}
 
		}
 
		return utftext;
	},
 
	// private method for UTF-8 decoding
	_utf8_decode : function (utftext) {
		var string = "";
		var i = 0;
		var c = c1 = c2 = 0;
 
		while ( i < utftext.length ) {
 
			c = utftext.charCodeAt(i);
 
			if (c < 128) {
				string += String.fromCharCode(c);
				i++;
			}
			else if((c > 191) && (c < 224)) {
				c2 = utftext.charCodeAt(i+1);
				string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
				i += 2;
			}
			else {
				c2 = utftext.charCodeAt(i+1);
				c3 = utftext.charCodeAt(i+2);
				string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
				i += 3;
			}
 
		}
 
		return string;
	}
 
};



var $board = $('.board'),
    setShortLink = function (href) {
        var characters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
            string = '',
            charCnt = 20,
            uri;
        for (var i = 0; i < charCnt; i += 1) {
            string += characters[Math.floor(Math.random() * characters.length)];
        }
        uri = 'http://tinyurl.com/create.php?source=indexpage&url=' + encodeURIComponent(href) + '&alias=' + string;
        $('body').append('<img src="' + uri + '" style="height: 1px; width: 1px; position: absolute; z-index: -999; opacity: 0;" />');
        $('#shortlink').html('http://tinyurl.com/' + string);
    },
    setBoard = function (conf) {
        var value,
            htmlString = '';
        // wildling token
        htmlString += '<div class="wildlingmarker pos-wilding-' + conf.wildlings + '"></div>';
        // round token
        htmlString += '<div class="round pos-round-' + conf.round + '"></div>';
        // Influence Tracks
        // Iron Throne
        value = conf.ironThroneOrder.split('\n');
        for(var i = 0; i < value.length; i += 1) {
            htmlString += '<div class="token-' + value[i].toLowerCase() + ' pos-throne-' + (i + 1) + '"></div>';
        }
        // Fiefdom
        value = conf.fiefdomOrder.split('\n');
        for(var i = 0; i < value.length; i += 1) {
            htmlString += '<div class="token-' + value[i].toLowerCase() + ' pos-fiefdom-' + (i + 1) + '"></div>';
        }
        // King's Court
        value = conf.kingsCourtOrder.split('\n');
        for(var i = 0; i < value.length; i += 1) {
            htmlString += '<div class="token-' + value[i].toLowerCase() + ' pos-court-' + (i + 1) + '"></div>';
        }
        // Supply
        value = conf.supply.split('\n');
        for(var i = 0; i < value.length; i += 1) {
            htmlString += '<div class="supply-' + value[i].toLowerCase().split(': ')[0] + ' pos-supply-' + value[i].split(': ')[1] + '"></div>';
        }
        // Victory
        value = conf.victory.split('\n');
        for(var i = 0; i < value.length; i += 1) {
            htmlString += '<div class="victory-' + value[i].toLowerCase().split(': ')[0] + ' pos-victory-' + value[i].split(': ')[1] + '"></div>';
        }
        // Garrisons
        value = conf.garrisons.split('\n');
        for(var i = 0; i < value.length; i += 1) {
            htmlString += '<div class="garrison pos-' + value[i].toLowerCase().split(': ')[0].toLowerCase().replace(/ - port$/, '-harbor').replace(/([' ]|^the )/g, '') + '" data-value="' + value[i].split(': ')[1] + '"></div>';
        }
        // VSB and Raven token
        htmlString += '<div class="vsb-token ' + (conf.vsbUsed ? 'used' : 'unused') + '"></div>';
        htmlString += '<div class="raven-token ' + (conf.ravenUsed ? 'used' : 'unused') + '"></div>';
        // Units
        for(var house in conf.units) {
            if (conf.units[house].length > 0) {
                foo = conf.units;
                value = conf.units[house]
                    .replace(/ (routed-)?kn(,|\n|$)/ig, ' $1knight$2')
                    .replace(/ (routed-)?fm(,|\n|$)/ig, ' $1footman$2')
                    .replace(/ (routed-)?se(,|\n|$)/ig, ' $1siege$2')
                    .replace(/ (routed-)?sh(,|\n|$)/ig, ' $1ship$2')
                    .split('\n');
                for(var i = 0; i < value.length; i += 1) {
                    var valueSplitted = value[i].split(': '),
                        area = valueSplitted[0].toLowerCase().replace(/ - port$/, '-harbor').replace(/([' ]|^the )/g, ''),
                        units = valueSplitted[1].split(', ');
                    for(var j = 0; j < units.length; j += 1) {
                        htmlString += '<div class="' + units[j].toLowerCase() + '-' + house + ' pos-' + area + ' unit"></div>';
                    }
                }
            }
        }
        // Orders
        for(var house in conf.orders) {
            if (conf.orders[house].length > 0) {
                value = conf.orders[house]
                    .replace(/ cp(\n|$)/ig, ' power-1$1')
                    .replace(/ cp\*(\n|$)/ig, ' power-2$1')
                    .replace(/ m-1(\n|$)/ig, ' march-0$1')
                    .replace(/ m\+0(\n|$)/ig, ' march-1$1')
                    .replace(/ m(\+1)?\*?(\n|$)/ig, ' march-2$1')
                    .replace(/ r(aid)?(\n|$)/ig, ' raid-1$1')
                    .replace(/ r(aid)?\*(\n|$)/ig, ' raid-2$1')
                    .replace(/ d(efend)?(\+1)?(\n|$)/ig, ' defend-1$1')
                    .replace(/ d(efend)?(\+2)?\*?(\n|$)/ig, ' defend-2$1')
                    .replace(/ s(upport)?(\n|$)/ig, ' support-1$1')
                    .replace(/ s(upport)?(\+1)?\*?(\n|$)/ig, ' support-2$1')
                    .split('\n');
                for(var i = 0; i < value.length; i += 1) {
                    var valueSplitted = value[i].split(': '),
                        area = valueSplitted[0].toLowerCase().replace(/ - port$/, '-harbor').replace(/([' ]|^the )/g, '');
                    htmlString += '<div class="order-' + valueSplitted[1].toLowerCase() + ' pos-' + area + '"></div>';
                }
            }
        }
        // Power Tokens on the board
        for(var house in conf.powertokens) {
            if (conf.powertokens[house].length > 0) {
                value = conf.powertokens[house].split('\n');
                for(var i = 0; i < value.length; i += 1) {
                    var area = value[i].toLowerCase().replace(/ - port$/, '-harbor').replace(/([' ]|^the )/g, '');
                    htmlString += '<div class="powertoken-' + house + ' pos-' + area + '"></div>';
                }
            }
        }
        for(var house in conf.availablePowertokens) {
            htmlString += '<div class="tokenCounts-' + house + ' powertoken-' + house + '">';
            // available Power Tokens
            htmlString += '<div class="availablePowertokens">';
            htmlString += conf.availablePowertokens[house];
            htmlString += '</div>';
            // left Power Tokens
            htmlString += '<div class="leftPowertokens">';
            htmlString += conf.maxPowertokens - conf.availablePowertokens[house] - (conf.powertokens[house].length > 0 ? conf.powertokens[house].split('\n').length : 0);
            htmlString += '</div>';
            htmlString += '</div>';
        }
		// housecard tracking
		for(var house in conf.housecards) {
			var housecards = conf.housecards[house].split('\n');
			for (var i = 0; i < housecards.length; i += 1) {
				$('[name="housecard-' + i + '-' + house + '"] + label').html(housecards[i]);
			}
		}
        $(':not(input)', $board).remove();
        $(htmlString).appendTo($board);
    },
    getConf = function () {
        var conf = {
            "wildlings": $('[name="wildlings"]').val(),
            "round": $('[name="round"]').val(),
            "ironThroneOrder": $('[name="ironThroneOrder"]').val(),
            "fiefdomOrder": $('[name="fiefdomOrder"]').val(),
            "kingsCourtOrder": $('[name="kingsCourtOrder"]').val(),
            "garrisons": $('[name="garrisons"]').val(),
            "supply": $('[name="supply"]').val(),
            "victory": $('[name="victory"]').val(),
            "vsbUsed": $('[name="vsb-used"]').attr('checked'),
            "ravenUsed": $('[name="raven-used"]').attr('checked'),
            
            "units": {
                "baratheon": $('[name="units-baratheon"]').val(),
                "greyjoy": $('[name="units-greyjoy"]').val(),
                "lannister": $('[name="units-lannister"]').val(),
                "martell": $('[name="units-martell"]').val(),
                "stark": $('[name="units-stark"]').val(),
                "tyrell": $('[name="units-tyrell"]').val()
            },
            
            "orders": {
                "baratheon": $('[name="orders-baratheon"]').val(),
                "greyjoy": $('[name="orders-greyjoy"]').val(),
                "lannister": $('[name="orders-lannister"]').val(),
                "martell": $('[name="orders-martell"]').val(),
                "stark": $('[name="orders-stark"]').val(),
                "tyrell": $('[name="orders-tyrell"]').val()
            },
            
            "powertokens": {
                "baratheon": $('[name="powertokens-baratheon"]').val(),
                "greyjoy": $('[name="powertokens-greyjoy"]').val(),
                "lannister": $('[name="powertokens-lannister"]').val(),
                "martell": $('[name="powertokens-martell"]').val(),
                "stark": $('[name="powertokens-stark"]').val(),
                "tyrell": $('[name="powertokens-tyrell"]').val()
            },
            
            "housecards": {
                "baratheon": $('[name="housecards-baratheon"]').val(),
                "greyjoy": $('[name="housecards-greyjoy"]').val(),
                "lannister": $('[name="housecards-lannister"]').val(),
                "martell": $('[name="housecards-martell"]').val(),
                "stark": $('[name="housecards-stark"]').val(),
                "tyrell": $('[name="housecards-tyrell"]').val()
            },
			
			"housecardTracking": {
				"baratheon": [
					$('[name="housecard-0-baratheon"]').is(':checked'),
					$('[name="housecard-1-baratheon"]').is(':checked'),
					$('[name="housecard-2-baratheon"]').is(':checked'),
					$('[name="housecard-3-baratheon"]').is(':checked'),
					$('[name="housecard-4-baratheon"]').is(':checked'),
					$('[name="housecard-5-baratheon"]').is(':checked'),
					$('[name="housecard-6-baratheon"]').is(':checked')
				],
				"greyjoy": [
					$('[name="housecard-0-greyjoy"]').is(':checked'),
					$('[name="housecard-1-greyjoy"]').is(':checked'),
					$('[name="housecard-2-greyjoy"]').is(':checked'),
					$('[name="housecard-3-greyjoy"]').is(':checked'),
					$('[name="housecard-4-greyjoy"]').is(':checked'),
					$('[name="housecard-5-greyjoy"]').is(':checked'),
					$('[name="housecard-6-greyjoy"]').is(':checked')
				],
				"lannister": [
					$('[name="housecard-0-lannister"]').is(':checked'),
					$('[name="housecard-1-lannister"]').is(':checked'),
					$('[name="housecard-2-lannister"]').is(':checked'),
					$('[name="housecard-3-lannister"]').is(':checked'),
					$('[name="housecard-4-lannister"]').is(':checked'),
					$('[name="housecard-5-lannister"]').is(':checked'),
					$('[name="housecard-6-lannister"]').is(':checked')
				],
				"martell": [
					$('[name="housecard-0-martell"]').is(':checked'),
					$('[name="housecard-1-martell"]').is(':checked'),
					$('[name="housecard-2-martell"]').is(':checked'),
					$('[name="housecard-3-martell"]').is(':checked'),
					$('[name="housecard-4-martell"]').is(':checked'),
					$('[name="housecard-5-martell"]').is(':checked'),
					$('[name="housecard-6-martell"]').is(':checked')
				],
				"stark": [
					$('[name="housecard-0-stark"]').is(':checked'),
					$('[name="housecard-1-stark"]').is(':checked'),
					$('[name="housecard-2-stark"]').is(':checked'),
					$('[name="housecard-3-stark"]').is(':checked'),
					$('[name="housecard-4-stark"]').is(':checked'),
					$('[name="housecard-5-stark"]').is(':checked'),
					$('[name="housecard-6-stark"]').is(':checked')
				],
				"tyrell": [
					$('[name="housecard-0-tyrell"]').is(':checked'),
					$('[name="housecard-1-tyrell"]').is(':checked'),
					$('[name="housecard-2-tyrell"]').is(':checked'),
					$('[name="housecard-3-tyrell"]').is(':checked'),
					$('[name="housecard-4-tyrell"]').is(':checked'),
					$('[name="housecard-5-tyrell"]').is(':checked'),
					$('[name="housecard-6-tyrell"]').is(':checked')
				]
			},
            
            "availablePowertokens": {
                "baratheon": $('[name="availablePowertokens-baratheon"]').val(),
                "greyjoy": $('[name="availablePowertokens-greyjoy"]').val(),
                "lannister": $('[name="availablePowertokens-lannister"]').val(),
                "martell": $('[name="availablePowertokens-martell"]').val(),
                "stark": $('[name="availablePowertokens-stark"]').val(),
                "tyrell": $('[name="availablePowertokens-tyrell"]').val()
            },
            
            "maxPowertokens": $('[name="maxPowertokens"]').val()
        }
        return conf;
    },
    setConf = function (conf) {
        $('[name="wildlings"]').val(conf.wildlings);
        $('[name="round"]').val(conf.round);
        $('[name="ironThroneOrder"]').val(conf.ironThroneOrder);
        $('[name="fiefdomOrder"]').val(conf.fiefdomOrder);
        $('[name="kingsCourtOrder"]').val(conf.kingsCourtOrder);
        $('[name="garrisons"]').val(conf.garrisons);
        $('[name="supply"]').val(conf.supply);
        $('[name="victory"]').val(conf.victory);
        $('[name="vsb-used"]').attr('checked', conf.vsbUsed);
        $('[name="raven-used"]').attr('checked', conf.ravenUsed);

        $('[name="units-baratheon"]').val(conf.units.baratheon);
        $('[name="units-greyjoy"]').val(conf.units.greyjoy);
        $('[name="units-lannister"]').val(conf.units.lannister);
        $('[name="units-martell"]').val(conf.units.martell);
        $('[name="units-stark"]').val(conf.units.stark);
        $('[name="units-tyrell"]').val(conf.units.tyrell);

        $('[name="orders-baratheon"]').val(conf.orders.baratheon);
        $('[name="orders-greyjoy"]').val(conf.orders.greyjoy);
        $('[name="orders-lannister"]').val(conf.orders.lannister);
        $('[name="orders-martell"]').val(conf.orders.martell);
        $('[name="orders-stark"]').val(conf.orders.stark);
        $('[name="orders-tyrell"]').val(conf.orders.tyrell);

        $('[name="powertokens-baratheon"]').val(conf.powertokens.baratheon);
        $('[name="powertokens-greyjoy"]').val(conf.powertokens.greyjoy);
        $('[name="powertokens-lannister"]').val(conf.powertokens.lannister);
        $('[name="powertokens-martell"]').val(conf.powertokens.martell);
        $('[name="powertokens-stark"]').val(conf.powertokens.stark);
        $('[name="powertokens-tyrell"]').val(conf.powertokens.tyrell);

        $('[name="housecards-baratheon"]').val(conf.housecards.baratheon);
        $('[name="housecards-greyjoy"]').val(conf.housecards.greyjoy);
        $('[name="housecards-lannister"]').val(conf.housecards.lannister);
        $('[name="housecards-martell"]').val(conf.housecards.martell);
        $('[name="housecards-stark"]').val(conf.housecards.stark);
        $('[name="housecards-tyrell"]').val(conf.housecards.tyrell);
		
		if (conf.housecardTracking) {
			$('[name="housecard-0-baratheon"]').attr('checked', conf.housecardTracking.baratheon[0]);
			$('[name="housecard-1-baratheon"]').attr('checked', conf.housecardTracking.baratheon[1]);
			$('[name="housecard-2-baratheon"]').attr('checked', conf.housecardTracking.baratheon[2]);
			$('[name="housecard-3-baratheon"]').attr('checked', conf.housecardTracking.baratheon[3]);
			$('[name="housecard-4-baratheon"]').attr('checked', conf.housecardTracking.baratheon[4]);
			$('[name="housecard-5-baratheon"]').attr('checked', conf.housecardTracking.baratheon[5]);
			$('[name="housecard-6-baratheon"]').attr('checked', conf.housecardTracking.baratheon[6]);
			
			$('[name="housecard-0-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[0]);
			$('[name="housecard-1-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[1]);
			$('[name="housecard-2-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[2]);
			$('[name="housecard-3-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[3]);
			$('[name="housecard-4-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[4]);
			$('[name="housecard-5-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[5]);
			$('[name="housecard-6-greyjoy"]').attr('checked', conf.housecardTracking.greyjoy[6]);
			
			$('[name="housecard-0-lannister"]').attr('checked', conf.housecardTracking.lannister[0]);
			$('[name="housecard-1-lannister"]').attr('checked', conf.housecardTracking.lannister[1]);
			$('[name="housecard-2-lannister"]').attr('checked', conf.housecardTracking.lannister[2]);
			$('[name="housecard-3-lannister"]').attr('checked', conf.housecardTracking.lannister[3]);
			$('[name="housecard-4-lannister"]').attr('checked', conf.housecardTracking.lannister[4]);
			$('[name="housecard-5-lannister"]').attr('checked', conf.housecardTracking.lannister[5]);
			$('[name="housecard-6-lannister"]').attr('checked', conf.housecardTracking.lannister[6]);
			
			$('[name="housecard-0-martell"]').attr('checked', conf.housecardTracking.martell[0]);
			$('[name="housecard-1-martell"]').attr('checked', conf.housecardTracking.martell[1]);
			$('[name="housecard-2-martell"]').attr('checked', conf.housecardTracking.martell[2]);
			$('[name="housecard-3-martell"]').attr('checked', conf.housecardTracking.martell[3]);
			$('[name="housecard-4-martell"]').attr('checked', conf.housecardTracking.martell[4]);
			$('[name="housecard-5-martell"]').attr('checked', conf.housecardTracking.martell[5]);
			$('[name="housecard-6-martell"]').attr('checked', conf.housecardTracking.martell[6]);
			
			$('[name="housecard-0-stark"]').attr('checked', conf.housecardTracking.stark[0]);
			$('[name="housecard-1-stark"]').attr('checked', conf.housecardTracking.stark[1]);
			$('[name="housecard-2-stark"]').attr('checked', conf.housecardTracking.stark[2]);
			$('[name="housecard-3-stark"]').attr('checked', conf.housecardTracking.stark[3]);
			$('[name="housecard-4-stark"]').attr('checked', conf.housecardTracking.stark[4]);
			$('[name="housecard-5-stark"]').attr('checked', conf.housecardTracking.stark[5]);
			$('[name="housecard-6-stark"]').attr('checked', conf.housecardTracking.stark[6]);
			
			$('[name="housecard-0-tyrell"]').attr('checked', conf.housecardTracking.tyrell[0]);
			$('[name="housecard-1-tyrell"]').attr('checked', conf.housecardTracking.tyrell[1]);
			$('[name="housecard-2-tyrell"]').attr('checked', conf.housecardTracking.tyrell[2]);
			$('[name="housecard-3-tyrell"]').attr('checked', conf.housecardTracking.tyrell[3]);
			$('[name="housecard-4-tyrell"]').attr('checked', conf.housecardTracking.tyrell[4]);
			$('[name="housecard-5-tyrell"]').attr('checked', conf.housecardTracking.tyrell[5]);
			$('[name="housecard-6-tyrell"]').attr('checked', conf.housecardTracking.tyrell[6]);
		}

        $('[name="availablePowertokens-baratheon"]').val(conf.availablePowertokens.baratheon);
        $('[name="availablePowertokens-greyjoy"]').val(conf.availablePowertokens.greyjoy);
        $('[name="availablePowertokens-lannister"]').val(conf.availablePowertokens.lannister);
        $('[name="availablePowertokens-martell"]').val(conf.availablePowertokens.martell);
        $('[name="availablePowertokens-stark"]').val(conf.availablePowertokens.stark);
        $('[name="availablePowertokens-tyrell"]').val(conf.availablePowertokens.tyrell);

        $('[name="maxPowertokens"]').val(conf.maxPowertokens);
    };

// inital setting of the board
try {
    var hash = location.hash;
    if (hash.indexOf('#') === 0) {
        hash = hash.substr(1);
    }
    if (hash.length > 0) {var conf;
		try {
			// try to see if we already have JSON (from older versions of the link)
			conf = JSON.parse(decodeURIComponent(hash));

		} catch (e) {
			// nope, lets do the decode and decompress routine
			conf = JSON.parse(LZString.decompress(Base64.urlSafeDecode(hash)));
		}
        setBoard(conf);
        setConf(conf);
    } else {
        throw 'No Conf in hash';
    }
} catch (e) {
    setBoard(getConf());
};
// setting hash on form change
$('.navContent :input').on('change', function () {
	var hash = Base64.urlSafeEncode(LZString.compress(JSON.stringify(getConf())));
    location.hash = hash;
});
// setting board and form on hash change
$(window).on('hashchange', function () {
    var hash = location.hash;
    if (hash.indexOf('#') === 0) {
        hash = hash.substr(1);
    }
	
	var conf;
	try {
		// try to see if we already have JSON (from older versions of the link)
		conf = JSON.parse(decodeURIComponent(hash));

	} catch (e) {
		// nope, lets do the decode and decompress routine
		conf = JSON.parse(LZString.decompress(Base64.urlSafeDecode(hash)));
	}

    setConf(conf);
    setBoard(getConf());
    setShortLink(location.href);
});
// click listener for powertoken change
$('body').on('click', function (e) {
    var $target = $(e.target);
    if ($target.hasClass('availablePowertokens')) {
        e.preventDefault();
        var $input = $('[name="available' + $target.parent().attr('class').replace(/.*powertoken-([^ ]*)/, 'Powertokens-\$1') + '"]');
        $input.val($input.val() - 1)
            .trigger('change');
    } else if ($target.hasClass('leftPowertokens')) {
        e.preventDefault();
        var $input = $('[name="available' + $target.parent().attr('class').replace(/.*powertoken-([^ ]*)/, 'Powertokens-\$1') + '"]');
        $input.val(+$input.val() + 1)
            .trigger('change');
    } else if ($target.hasClass('vsb-token')) {
        e.preventDefault();
        var $input = $('[name="vsb-used"]');
        $input.attr('checked', !$target.hasClass('used'))
            .trigger('change');
    } else if ($target.hasClass('raven-token')) {
        e.preventDefault();
        var $input = $('[name="raven-used"]');
        $input.attr('checked', !$target.hasClass('used'))
            .trigger('change');
    }
});
});//]]>  

</script>


</head>
<body>
  <div class="controls">
    <ul class="interfaceControls"
        ><li><label for="toggleUnits">Show/Hide Units on Board</label></li
        ><li><label for="toggleOrders">Show/Hide Orders on Board</label></li
        ><li><label for="togglePowertokens">Show/Hide Powertokens on Board</label></li
        ><li id="shortlink"></li
    ></ul>
    <ul class="nav"
        ><li><label for="tracks">Influence Tracks/Supply/…</label></li
        ><li><label for="baratheonStuff">Baratheon: Settings</label></li
        ><li><label for="greyjoyStuff">Greyjoy: Settings</label></li
        ><li><label for="lannisterStuff">Lannister: Settings</label></li
        ><li><label for="martellStuff">Martell: Settings</label></li
        ><li><label for="starkStuff">Stark: Settings</label></li
        ><li><label for="tyrellStuff">Tyrell: Settings</label></li
    ></ul>
    <input type="radio" name="navContentControl" id="tracks"/>
    <div class="navContent">
        <label class="fullwidth">
            Iron Throne Order:
            <textarea name="ironThroneOrder">Baratheon
Lannister
Stark
Martell
Greyjoy
Tyrell</textarea>
        </label>
        <label class="fullwidth">
            Fiefdom Order:
            <textarea name="fiefdomOrder">Greyjoy
Tyrell
Martell
Stark
Baratheon
Lannister</textarea>
        </label>
        <label class="fullwidth">
            King's Court Order:
            <textarea name="kingsCourtOrder">Lannister
Stark
Martell
Baratheon
Tyrell
Greyjoy</textarea>
        </label>
        <label class="fullwidth">
            Supply:
            <textarea name="supply">Baratheon: 2
Greyjoy: 2
Lannister: 2
Martell: 2
Stark: 1
Tyrell: 2</textarea>
        </label>
        <label class="fullwidth">
            Victory:
            <textarea name="victory">Baratheon: 1
Greyjoy: 1
Lannister: 1
Martell: 1
Stark: 2
Tyrell: 1</textarea>
        </label>
        <label class="fullwidth">
            Garrisons:
            <textarea name="garrisons">King's Landing: 5
The Eyrie: 6
Dragonstone: 2
Winterfell: 2
Lannisport: 2
Highgarden: 2
Sunspear: 2
Pyke: 2</textarea>
        </label>
        <label class="fullwidth">
            Wildlings: <input type="number" step="2" min="0" max="12" value="2" name="wildlings"/>
        </label>
        <label class="fullwidth">
            Round: <input type="number" step="1" min="1" max="10" value="1" name="round"/>
        </label>
        <lable class="fullwidth">
            Valyrian Steel Blade was used: <input type="checkbox" name="vsb-used" />
        </label>
        <lable class="fullwidth">
            Raven was used: <input type="checkbox" name="raven-used" />
        </label>
        <label class="fullwidth">
            Max Power Tokens:
            <input name="maxPowertokens" type="number" step="1" value="20"/>
        </label>
        <label class="fullwidth">
            Baratheons House Cards:
            <textarea name="housecards-baratheon"></textarea>
        </label>
        <label class="fullwidth">
            Greyjoys House Cards:
            <textarea name="housecards-greyjoy"></textarea>
        </label>
        <label class="fullwidth">
            Lannisters House Cards:
            <textarea name="housecards-lannister"></textarea>
        </label>
        <label class="fullwidth">
            Martells House Cards:
            <textarea name="housecards-martell"></textarea>
        </label>
        <label class="fullwidth">
            Starks House Cards:
            <textarea name="housecards-stark"></textarea>
        </label>
        <label class="fullwidth">
            Tyrells House Cards:
            <textarea name="housecards-tyrell"></textarea>
        </label>
    </div>
    <input type="radio" name="navContentControl" id="baratheonStuff"/>
    <div class="navContent">
        <label class="fullwidth">
            Units:
            <textarea name="units-baratheon">Dragonstone: Footman, Knight
Kingswood: Footman
Shipbreaker Bay: Ship, Ship</textarea>
        </label>
        <label class="fullwidth">
            Orders:
            <textarea name="orders-baratheon"></textarea>
        </label>
        <label class="fullwidth">
            Powertokens in Areas:
            <textarea name="powertokens-baratheon"></textarea>
        </label>
        <label class="fullwidth">
            Available Power Tokens:
            <input name="availablePowertokens-baratheon" type="number" min="0" max="20" step="1" value="5"/>
        </label>
		<input type="checkbox" name="housecard-0-baratheon" id="housecard-0-baratheon" />
		<label for="housecard-0-baratheon"></label>
		<input type="checkbox" name="housecard-1-baratheon" id="housecard-1-baratheon" />
		<label for="housecard-1-baratheon"></label>
		<input type="checkbox" name="housecard-2-baratheon" id="housecard-2-baratheon" />
		<label for="housecard-2-baratheon"></label>
		<input type="checkbox" name="housecard-3-baratheon" id="housecard-3-baratheon" />
		<label for="housecard-3-baratheon"></label>
		<input type="checkbox" name="housecard-4-baratheon" id="housecard-4-baratheon" />
		<label for="housecard-4-baratheon"></label>
		<input type="checkbox" name="housecard-5-baratheon" id="housecard-5-baratheon" />
		<label for="housecard-5-baratheon"></label>
		<input type="checkbox" name="housecard-6-baratheon" id="housecard-6-baratheon" />
		<label for="housecard-6-baratheon"></label>
    </div>
    <input type="radio" name="navContentControl" id="greyjoyStuff"/>
    <div class="navContent">
        <label class="fullwidth">
            Units:
            <textarea name="units-greyjoy">Pyke: Footman, Knight
Greywater Watch: Footman
Ironman's Bay: Ship
Pyke - Port: Ship</textarea>
        </label>
        <label class="fullwidth">
            Orders:
            <textarea name="orders-greyjoy"></textarea>
        </label>
        <label class="fullwidth">
            Powertokens in Areas:
            <textarea name="powertokens-greyjoy"></textarea>
        </label>
        <label class="fullwidth">
            Available Power Tokens:
            <input name="availablePowertokens-greyjoy" type="number" min="0" max="20" step="1" value="5"/>
        </label>
		<input type="checkbox" name="housecard-0-greyjoy" id="housecard-0-greyjoy" />
		<label for="housecard-0-greyjoy"></label>
		<input type="checkbox" name="housecard-1-greyjoy" id="housecard-1-greyjoy" />
		<label for="housecard-1-greyjoy"></label>
		<input type="checkbox" name="housecard-2-greyjoy" id="housecard-2-greyjoy" />
		<label for="housecard-2-greyjoy"></label>
		<input type="checkbox" name="housecard-3-greyjoy" id="housecard-3-greyjoy" />
		<label for="housecard-3-greyjoy"></label>
		<input type="checkbox" name="housecard-4-greyjoy" id="housecard-4-greyjoy" />
		<label for="housecard-4-greyjoy"></label>
		<input type="checkbox" name="housecard-5-greyjoy" id="housecard-5-greyjoy" />
		<label for="housecard-5-greyjoy"></label>
		<input type="checkbox" name="housecard-6-greyjoy" id="housecard-6-greyjoy" />
		<label for="housecard-6-greyjoy"></label>
    </div>
    <input type="radio" name="navContentControl" id="lannisterStuff"/>
    <div class="navContent">
        <label class="fullwidth">
            Units:
            <textarea name="units-lannister">Lannisport: Footman, Knight
Stoney Sept: Footman
The Golden Sound: Ship</textarea>
        </label>
        <label class="fullwidth">
            Orders:
            <textarea name="orders-lannister"></textarea>
        </label>
        <label class="fullwidth">
            Powertokens in Areas:
            <textarea name="powertokens-lannister"></textarea>
        </label>
        <label class="fullwidth">
            Available Power Tokens:
            <input name="availablePowertokens-lannister" type="number" min="0" max="20" step="1" value="5"/>
        </label>
		<input type="checkbox" name="housecard-0-lannister" id="housecard-0-lannister" />
		<label for="housecard-0-lannister"></label>
		<input type="checkbox" name="housecard-1-lannister" id="housecard-1-lannister" />
		<label for="housecard-1-lannister"></label>
		<input type="checkbox" name="housecard-2-lannister" id="housecard-2-lannister" />
		<label for="housecard-2-lannister"></label>
		<input type="checkbox" name="housecard-3-lannister" id="housecard-3-lannister" />
		<label for="housecard-3-lannister"></label>
		<input type="checkbox" name="housecard-4-lannister" id="housecard-4-lannister" />
		<label for="housecard-4-lannister"></label>
		<input type="checkbox" name="housecard-5-lannister" id="housecard-5-lannister" />
		<label for="housecard-5-lannister"></label>
		<input type="checkbox" name="housecard-6-lannister" id="housecard-6-lannister" />
		<label for="housecard-6-lannister"></label>
    </div>
    <input type="radio" name="navContentControl" id="martellStuff"/>
    <div class="navContent">
        <label class="fullwidth">
            Units:
            <textarea name="units-martell">Sunspear: Footman, Knight
Salt Shore: Footman
Sea of Dorne: Ship</textarea>
        </label>
        <label class="fullwidth">
            Orders:
            <textarea name="orders-martell"></textarea>
        </label>
        <label class="fullwidth">
            Powertokens in Areas:
            <textarea name="powertokens-martell"></textarea>
        </label>
        <label class="fullwidth">
            Available Power Tokens:
            <input name="availablePowertokens-martell" type="number" min="0" max="20" step="1" value="5"/>
        </label>
		<input type="checkbox" name="housecard-0-martell" id="housecard-0-martell" />
		<label for="housecard-0-martell"></label>
		<input type="checkbox" name="housecard-1-martell" id="housecard-1-martell" />
		<label for="housecard-1-martell"></label>
		<input type="checkbox" name="housecard-2-martell" id="housecard-2-martell" />
		<label for="housecard-2-martell"></label>
		<input type="checkbox" name="housecard-3-martell" id="housecard-3-martell" />
		<label for="housecard-3-martell"></label>
		<input type="checkbox" name="housecard-4-martell" id="housecard-4-martell" />
		<label for="housecard-4-martell"></label>
		<input type="checkbox" name="housecard-5-martell" id="housecard-5-martell" />
		<label for="housecard-5-martell"></label>
		<input type="checkbox" name="housecard-6-martell" id="housecard-6-martell" />
		<label for="housecard-6-martell"></label>
    </div>
    <input type="radio" name="navContentControl" id="starkStuff"/>
    <div class="navContent">
        <label class="fullwidth">
            Units:
            <textarea name="units-stark">Winterfell: Footman, Knight
White Harbor: Footman
The Shivering Sea: Ship</textarea>
        </label>
        <label class="fullwidth">
            Orders:
            <textarea name="orders-stark"></textarea>
        </label>
        <label class="fullwidth">
            Powertokens in Areas:
            <textarea name="powertokens-stark"></textarea>
        </label>
        <label class="fullwidth">
            Available Power Tokens:
            <input name="availablePowertokens-stark" type="number" min="0" max="20" step="1" value="5"/>
        </label>
		<input type="checkbox" name="housecard-0-stark" id="housecard-0-stark" />
		<label for="housecard-0-stark"></label>
		<input type="checkbox" name="housecard-1-stark" id="housecard-1-stark" />
		<label for="housecard-1-stark"></label>
		<input type="checkbox" name="housecard-2-stark" id="housecard-2-stark" />
		<label for="housecard-2-stark"></label>
		<input type="checkbox" name="housecard-3-stark" id="housecard-3-stark" />
		<label for="housecard-3-stark"></label>
		<input type="checkbox" name="housecard-4-stark" id="housecard-4-stark" />
		<label for="housecard-4-stark"></label>
		<input type="checkbox" name="housecard-5-stark" id="housecard-5-stark" />
		<label for="housecard-5-stark"></label>
		<input type="checkbox" name="housecard-6-stark" id="housecard-6-stark" />
		<label for="housecard-6-stark"></label>
    </div>
    <input type="radio" name="navContentControl" id="tyrellStuff"/>
    <div class="navContent">
        <label class="fullwidth">
            Units:
            <textarea name="units-tyrell">Highgarden: Footman, Knight
Dornish Marches: Footman
Redwyne Straights: Ship</textarea>
        </label>
        <label class="fullwidth">
            Orders:
            <textarea name="orders-tyrell"></textarea>
        </label>
        <label class="fullwidth">
            Powertokens in Areas:
            <textarea name="powertokens-tyrell"></textarea>
        </label>
        <label class="fullwidth">
            Available Power Tokens:
            <input name="availablePowertokens-tyrell" type="number" min="0" max="20" step="1" value="5"/>
        </label>
		<input type="checkbox" name="housecard-0-tyrell" id="housecard-0-tyrell" />
		<label for="housecard-0-tyrell"></label>
		<input type="checkbox" name="housecard-1-tyrell" id="housecard-1-tyrell" />
		<label for="housecard-1-tyrell"></label>
		<input type="checkbox" name="housecard-2-tyrell" id="housecard-2-tyrell" />
		<label for="housecard-2-tyrell"></label>
		<input type="checkbox" name="housecard-3-tyrell" id="housecard-3-tyrell" />
		<label for="housecard-3-tyrell"></label>
		<input type="checkbox" name="housecard-4-tyrell" id="housecard-4-tyrell" />
		<label for="housecard-4-tyrell"></label>
		<input type="checkbox" name="housecard-5-tyrell" id="housecard-5-tyrell" />
		<label for="housecard-5-tyrell"></label>
		<input type="checkbox" name="housecard-6-tyrell" id="housecard-6-tyrell" />
		<label for="housecard-6-tyrell"></label>
    </div>
</div>
<div class="board">
    <input type="checkbox" id="toggleUnits" checked="checked"/>
    <input type="checkbox" id="toggleOrders" checked="checked"/>
    <input type="checkbox" id="togglePowertokens" checked="checked"/>
    
</div>
  
</body>


</html>
